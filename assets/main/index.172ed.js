window.__require=function t(e,o,i){function r(a,s){if(!o[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var p=o[a]={exports:{}};e[a][0].call(p.exports,function(t){return r(e[a][1][t]||t)},p,p.exports,t,e,o,i)}return o[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<i.length;a++)r(i[a]);return r}({TetrisArrangedBlock:[function(t,e,o){"use strict";cc._RF.push(e,"ed52dgDpmBAsawPu65o/cde","TetrisArrangedBlock");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./TetrisBgGrid"),s=t("./common/TetrisConstant"),c=t("./common/TetrisData"),l=t("./common/TetrisEventType"),p=t("./common/TetrisObserver"),u=t("./common/TetrisUtil"),h=cc._decorator,f=h.ccclass,d=h.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.meshComp=null,e.outLineColor=cc.color(0,0,0),e.solidColor=cc.color(0,0,0),e.ctx=null,e.rowSuccessArr=[],e.blinkCount=5,e}return r(e,t),e.prototype.onLoad=function(){p.default.on(l.GAME_RESTART,this.restart,this),p.default.on(l.GAME_WAITING_TO_IN_GAME,this.predefinedRow,this),p.default.on(l.WRITE_GAME_STATUS,this.writeGameStatus,this)},e.prototype.getCtx=function(){return this.ctx?this.ctx:(this.ctx=this.node.getComponent(cc.Graphics),this.ctx)},e.prototype.clear=function(){this.getCtx().clear()},e.prototype.reset=function(){this.blinkCount=5,this.rowSuccessArr.length=0,this.clear()},e.prototype.writeGameStatus=function(t){t.keys.forEach(function(t){c.TetrisGameData.gameStatusMap[t]=1}),this.drawGameStates(),this.clearSuccess()},e.prototype.drawGameStates=function(){var t=Object.keys(c.TetrisGameData.gameStatusMap).filter(function(t){return c.TetrisGameData.gameStatusMap[t]}),e=this.meshComp.getBlockMap(),o=this.meshComp.getRectInfo(),i=o.blockLineWidth,r=o.inH,n=o.inW,a=o.offset,s=this.getCtx();s.clear();for(var l=0,p=t;l<p.length;l++){var u=p[l];if(e[u]){var h=e[u],f=h.x,d=h.y,_=h.width,T=h.height;s.lineWidth=i;var E=u.split("_")[0],m=this.rowSuccessArr.includes(parseInt(E));m&&this.rowSuccessArr.length>0?(s.strokeColor=this.outLineColor,s.strokeColor.a=this.blinkCount%2==1?50:100,s.rect(f,d,_,T),s.stroke()):(s.strokeColor=this.outLineColor,s.rect(f,d,_,T),s.stroke()),s.fillRect(f+a+i/2,d+a+i/2,n,r),s.fillColor=this.solidColor,m&&this.rowSuccessArr.length>0?s.fillColor.a=this.blinkCount%2==1?50:100:s.fillColor=this.solidColor,s.fill()}}},e.prototype.clearSuccess=function(){var t=this;this.unscheduleAllCallbacks();for(var e=this.meshComp.getRowCol().row,o=0;o<e;o++)this.rowSuccess(o)&&this.rowSuccessArr.push(o);0!==this.rowSuccessArr.length?(console.log("\u6e05\u7406\u5df2\u6ee1\u884c\u65b9\u5757"),this.drawGameStates(),this.schedule(function(){t.rowSuccessArr.length>0&&t.blinkCount>0?(--t.blinkCount,t.drawGameStates()):t.rowSuccessArr.length>0&&0===t.blinkCount&&(t.removeRowSuccess(),t.unscheduleAllCallbacks())},.1),p.default.emit(l.CLEAR_BLOCK_EVENT)):p.default.emit(l.GENERATE_FALLING_BLOCK)},e.prototype.removeRowSuccess=function(){var t=this;if(0!==this.rowSuccessArr.length){Object.keys(c.TetrisGameData.gameStatusMap).forEach(function(e){var o=e.split("_");t.rowSuccessArr.includes(parseInt(o[0]))&&(c.TetrisGameData.gameStatusMap[e]=0)});for(var e=this.meshComp.getRowCol(),o=e.row,i=e.col,r=Math.max.apply(Math,this.rowSuccessArr),n=this.rowSuccessArr.length,a=0;a<i;a++)for(var u=r+1;u<o;u++){var h=u+"_"+a;if(c.TetrisGameData.gameStatusMap[h]){var f=u-n+"_"+a;c.TetrisGameData.gameStatusMap[h]=0,c.TetrisGameData.gameStatusMap[f]=1}}c.TetrisGameData.score+=this.rowSuccessArr.length*s.ROW_SCORE,c.TetrisGameData.linesCleared+=this.rowSuccessArr.length,this.blinkCount=5,this.rowSuccessArr.length=0,this.drawGameStates(),p.default.emit(l.SCORE),p.default.emit(l.GENERATE_FALLING_BLOCK)}},e.prototype.rowSuccess=function(t){for(var e=this.meshComp.getRowCol().col,o=0;o<e;o++){var i=t+"_"+o;if(!c.TetrisGameData.gameStatusMap[i])return!1}return console.log("row \u6ee1:",t),!0},e.prototype.restart=function(t){var e=this,o=t.state,i=t.row;console.log("restart \u91cd\u73a9 \u6548\u679c\u4ece\u4e0b\u5f80\u4e0a\u94fa\u6ee1\u518d\u4ece\u4e0a\u5f80\u4e0b\u51cf\u5c11"),this.unscheduleAllCallbacks();var r=this.meshComp.getRowCol().row;this.schedule(function(){var t=o?1:0;return e.fillRow(i,t),e.drawGameStates(),i=o?i+1:i-1,!0===o&&r===i?(o=!1,void p.default.emit(l.GAME_ANI_FULL_SCREEN)):i<0?(console.log("\u65b9\u5757\u52a8\u753b\u7ed3\u675f"),e.unscheduleAllCallbacks(),void p.default.emit(l.RESTART_END_EVENT)):void 0},.05)},e.prototype.fillRow=function(t,e){for(var o=this.meshComp.getRowCol().col,i=0;i<o;i++){var r=t+"_"+i;c.TetrisGameData.gameStatusMap[r]=e}},e.prototype.predefinedRow=function(){for(var t=c.TetrisGameData.startLines,e=this.meshComp.getRowCol().col,o=0;o<t;o++){var i=u.randomPredefinedRow(o,e,3,2);console.log("row:",t,i);for(var r=0,n=Object.keys(i);r<n.length;r++){var a=n[r];c.TetrisGameData.gameStatusMap[a]=i[a]}}console.log("\u9884\u7f6e\u884c",c.TetrisGameData.gameStatusMap),this.drawGameStates()},e.prototype.onDestroy=function(){p.default.off(l.GAME_RESTART,this.restart,this)},n([d(a.default)],e.prototype,"meshComp",void 0),n([d],e.prototype,"outLineColor",void 0),n([d],e.prototype,"solidColor",void 0),n([f],e)}(cc.Component);o.default=_,cc._RF.pop()},{"./TetrisBgGrid":"TetrisBgGrid","./common/TetrisConstant":"TetrisConstant","./common/TetrisData":"TetrisData","./common/TetrisEventType":"TetrisEventType","./common/TetrisObserver":"TetrisObserver","./common/TetrisUtil":"TetrisUtil"}],TetrisBgGrid:[function(t,e,o){"use strict";cc._RF.push(e,"b82c1a0ql1E7bIzmSUFvcdf","TetrisBgGrid");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=a.executeInEditMode,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._refresh=!1,e.row=20,e.col=10,e.boardLineWidth=5,e.boardColor=cc.color(0,0,0),e.blockSpacing=10,e.blockLineWidth=2,e.blockLineColor=cc.color(220,220,220),e.inSolidBlockColor=cc.color(220,220,220),e.inSolidBlockPercent=7,e.rectInfo=null,e.blockMap=null,e}return r(e,t),Object.defineProperty(e.prototype,"refresh",{get:function(){return this._refresh},set:function(t){this._refresh=t,this.drawMap()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.calculateBlockMap(),this.drawMap()},e.prototype.clear=function(){this.getCtx().clear()},e.prototype.drawMap=function(){this.clear(),this.calculateBlockMap(),this.drawBoard(),this.drawOutBlock(),this.drawSolidBlock()},e.prototype.getRectInfo=function(){var t=this.getRectSize(),e=t.w,o=t.h,i=e/this.inSolidBlockPercent,r=e-2*i-this.blockLineWidth,n=o-2*i-this.blockLineWidth;return this.rectInfo={w:e,h:o,inH:n,inW:r,offset:i,blockLineColor:this.blockLineColor,blockLineWidth:this.blockLineWidth,spacing:this.blockSpacing},this.rectInfo},e.prototype.calculateBlockMap=function(){if(this.blockMap)return this.blockMap;this.blockMap={};for(var t=this.node,e=t.width,o=t.height,i=this.getRectInfo(),r=i.w,n=i.h,a=this.boardLineWidth/2,s=0;s<this.row;s++)for(var c=a+(s+1)*this.blockSpacing+n*s,l=0;l<this.col;l++){var p=a+(l+1)*this.blockSpacing+r*l,u=s+"_"+l;this.blockMap[u]=cc.rect(p-e/2,c-o/2,r,n)}return this.blockMap},e.prototype.drawByKeys=function(t,e,o){var i=this.getCtx();i.clear();var r=Object.keys(this.blockMap).filter(function(e){return!t.includes(e)});this.drawOutBlock(),this.drawSolidBlock(r);for(var n=0,a=t;n<a.length;n++){var s=a[n],c=this.getRectInfo(),l=c.offset,p=c.inH,u=c.inW,h=c.blockLineWidth,f=this.blockMap[s],d=f.x,_=f.y,T=f.width,E=f.height;i.lineWidth=h,i.strokeColor=e,i.rect(d,_,T,E),i.stroke();var m=h/2;i.rect(d+l+m,_+l+m,u,p),i.fillColor=o,i.fill()}},e.prototype.getBlockMap=function(){return this.calculateBlockMap()},e.prototype.getCtx=function(){return this.ctx||(this.ctx=this.node.getComponent(cc.Graphics)),this.ctx},e.prototype.getRowCol=function(){return{col:this.col,row:this.row}},e.prototype.drawBoard=function(){var t=this.getCtx(),e=this.node,o=e.width,i=e.height;t.strokeColor=this.boardColor,t.lineWidth=this.boardLineWidth,t.rect(-o/2,-i/2,o,i),t.stroke()},e.prototype.drawOutBlock=function(t){for(var e=this.getCtx(),o=0,i=t=t||Object.keys(this.blockMap);o<i.length;o++){var r=i[o],n=this.blockMap[r],a=n.x,s=n.y,c=n.width,l=n.height;e.lineWidth=this.blockLineWidth,e.strokeColor=this.blockLineColor,e.rect(a,s,c,l),e.stroke()}},e.prototype.drawSolidBlock=function(t){for(var e=this.getCtx(),o=this.getRectInfo(),i=o.offset,r=o.inH,n=o.inW,a=o.blockLineWidth/2,s=0,c=t=t||Object.keys(this.blockMap);s<c.length;s++){var l=c[s],p=this.blockMap[l],u=p.x,h=p.y;e.rect(u+i+a,h+i+a,n,r),e.fillColor=this.inSolidBlockColor,e.fill()}},e.prototype.getRectSize=function(){var t=this.node,e=t.width,o=t.height;return{w:(e-(this.col+1)*this.blockSpacing-this.boardLineWidth)/this.col,h:(o-(this.row+1)*this.blockSpacing-this.boardLineWidth)/this.row}},n([c],e.prototype,"_refresh",void 0),n([c],e.prototype,"refresh",null),n([c],e.prototype,"row",void 0),n([c],e.prototype,"col",void 0),n([c({tooltip:"\u5927\u578b\u5916\u6846\u7ebf\u7684\u5bbd\u5ea6"})],e.prototype,"boardLineWidth",void 0),n([c({tooltip:"\u5927\u578b\u5916\u6846\u7ebf\u7684\u989c\u8272"})],e.prototype,"boardColor",void 0),n([c({tooltip:"\u65b9\u5757\u95f4\u9694"})],e.prototype,"blockSpacing",void 0),n([c({tooltip:"\u65b9\u5757\u7ebf\u5bbd\u5ea6"})],e.prototype,"blockLineWidth",void 0),n([c({tooltip:"\u65b9\u5757\u7ebf\u6846\u989c\u8272"})],e.prototype,"blockLineColor",void 0),n([c({tooltip:"\u65b9\u5757\u5185\u7684\u586b\u5145\u989c\u8272"})],e.prototype,"inSolidBlockColor",void 0),n([c({tooltip:"\u5b9e\u5fc3\u65b9\u5757\u8ddd\u79bb\u65b9\u5757\u7684\u8ddd\u79bb w/n(w/7)"})],e.prototype,"inSolidBlockPercent",void 0),n([s,l],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],TetrisConstant:[function(t,e,o){"use strict";cc._RF.push(e,"d3ed2dfcQZAJrFELexZxW3h","TetrisConstant"),Object.defineProperty(o,"__esModule",{value:!0}),o.GAME_STATUS=o.ROW_SCORE=o.NORMAL_SCORE=o.BUTTON_EVENT=o.OprateRestule=o.OprateType=o.DropFourPoints=o.DropThreePoints=o.AllBlockStates=o.ZBlockStates=o.TBlockStates=o.OBlockStates=o.LBlockStates=o.IBlockStates=o.BlockTypeEnum=void 0,function(t){t[t.IBlock=0]="IBlock",t[t.LBlock=1]="LBlock",t[t.OBlock=2]="OBlock",t[t.TBlock=3]="TBlock",t[t.ZBlock=4]="ZBlock"}(o.BlockTypeEnum||(o.BlockTypeEnum={})),o.IBlockStates=[[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0]],o.LBlockStates=[[0,0,2,2,2,2,0,0,0],[2,2,0,0,2,0,0,2,0],[0,0,0,2,2,2,2,0,0],[2,0,0,2,0,0,2,2,0]],o.OBlockStates=[[0,3,3,0,3,3,0,0,0]],o.TBlockStates=[[0,4,0,4,4,4,0,0,0],[0,4,0,4,4,0,0,4,0],[0,0,0,4,4,4,0,4,0],[0,4,0,0,4,4,0,4,0]],o.ZBlockStates=[[0,0,0,5,5,0,0,5,5],[0,5,0,5,5,0,5,0,0]],o.AllBlockStates=[o.IBlockStates,o.LBlockStates,o.OBlockStates,o.TBlockStates,o.ZBlockStates],o.DropThreePoints=[[21,4],[21,5],[21,6],[20,4],[20,5],[20,6],[19,4],[19,5],[19,6]],o.DropFourPoints=[[22,3],[22,4],[22,5],[22,6],[21,3],[21,4],[21,5],[21,6],[20,3],[20,4],[20,5],[20,6],[19,3],[19,4],[19,5],[19,6]],o.OprateType={ROTATION:"rotation",LEFT_MOVE:"left_move",RIGHT_MOVE:"right_move",DOWN_MOVE:"down_move",SPACE:"space",PAUSE:"pause",RESTART:"restart",AUDIO:"audio"},o.OprateRestule={LEFT:1,RIGHT:2,DOWN:4},o.BUTTON_EVENT="button_click_event",o.NORMAL_SCORE=10,o.ROW_SCORE=100,o.GAME_STATUS={ANI_START:"animation_start",ANI_FALLING_UP:"ani_falling_up",WAITING:"waiting",IN_GAME:"in_game",GAME_OVER:"game_over",PAUSE:"game_pause"},cc._RF.pop()},{}],TetrisData:[function(t,e,o){"use strict";cc._RF.push(e,"e17f3Pgh01KhKBcYN9UjbwO","TetrisData"),Object.defineProperty(o,"__esModule",{value:!0}),o.TetrisGameData=void 0;var i=t("./TetrisConstant"),r=function(){function t(){}return t.resetData=function(){t.highestScore<t.score&&(t.highestScore=t.score),t.lastScore=t.score,t.score=0,t.gameStatus=i.GAME_STATUS.GAME_OVER,t.pause=!1,t.gameStatusMap={}},t.lanuage="cn",t.pause=!1,t.isCloseAudio=!1,t.gameStatus=i.GAME_STATUS.GAME_OVER,t.highestScore=0,t.lastScore=0,t.score=0,t.startLines=0,t.linesCleared=0,t.level=0,t.maxStartLines=10,t.maxLevel=6,t.gameStatusMap={},t.fallingBlockType=0,t.fallingBlockIndex=0,t}();o.TetrisGameData=r,cc._RF.pop()},{"./TetrisConstant":"TetrisConstant"}],TetrisEventType:[function(t,e,o){"use strict";cc._RF.push(e,"2b819w8qiJNcq1YquFA7P+u","TetrisEventType"),Object.defineProperty(o,"__esModule",{value:!0}),o.NEXT_FALLING_BLOCK=o.WRITE_GAME_STATUS=o.GAME_IN_GAME_TO_WAITING=o.GAME_WAITING_TO_IN_GAME=o.SET_CLEARED_ROW=o.SET_LEVEL=o.SET_START_ROW=o.SCORE=o.RESTART_END_EVENT=o.GAME_ANI_FULL_SCREEN=o.GENERATE_FALLING_BLOCK=o.CLEAR_FALLING_BLOCK_EVENT=o.HIDE_UI_LOADING_EVENT=o.SHOW_UI_LOADING_EVENT=o.CLEAR_BLOCK_EVENT=o.GAME_OVER_EVENT=o.GAME_START_EVENT=o.DOWN_MOVE_EVENT=o.LEFT_MOVE_EVENT=o.RIGHT_MOVE_EVENT=o.ROTATE_EVENT=o.SPACE_EVENT=o.TOGGLE_AUDIO_EVENT=o.OPEN_AUDIO_EVENT=o.GAME_RESTART=o.GAME_RECOVER=o.GAME_PAUSE=void 0,o.GAME_PAUSE="game_pause",o.GAME_RECOVER="game_recover",o.GAME_RESTART="game_restart",o.OPEN_AUDIO_EVENT="open_audio_event",o.TOGGLE_AUDIO_EVENT="togle_audio_event",o.SPACE_EVENT="space_event",o.ROTATE_EVENT="rotate_event",o.RIGHT_MOVE_EVENT="right_move_event",o.LEFT_MOVE_EVENT="left_move_event",o.DOWN_MOVE_EVENT="down_move_event",o.GAME_START_EVENT="game_start_event",o.GAME_OVER_EVENT="game_over_event",o.CLEAR_BLOCK_EVENT="clear_block_event",o.SHOW_UI_LOADING_EVENT="show_ui_loading_event",o.HIDE_UI_LOADING_EVENT="hide_ui_loading_event",o.CLEAR_FALLING_BLOCK_EVENT="clear_falling_block_event",o.GENERATE_FALLING_BLOCK="generate_falling_block",o.GAME_ANI_FULL_SCREEN="GAME_ANI_FULL_SCREEN",o.RESTART_END_EVENT="restart_end_event",o.SCORE="socre",o.SET_START_ROW="set_start_row_event",o.SET_LEVEL="set_level_event",o.SET_CLEARED_ROW="set_cleared_row",o.GAME_WAITING_TO_IN_GAME="status_waiting_to_in_game",o.GAME_IN_GAME_TO_WAITING="status_in_game_to_waiting",o.WRITE_GAME_STATUS="write_game_status",o.NEXT_FALLING_BLOCK="next_falling_block",cc._RF.pop()},{}],TetrisFallingBlock:[function(t,e,o){"use strict";cc._RF.push(e,"f13ff8JrANPO5iCl2FziYv8","TetrisFallingBlock");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./TetrisBgGrid"),s=t("./common/TetrisUtil"),c=t("./common/TetrisConstant"),l=t("./common/TetrisObserver"),p=t("./common/TetrisEventType"),u=t("./common/TetrisData"),h=cc._decorator,f=h.ccclass,d=h.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.meshComp=null,e.outLineColor=cc.color(0,0,0),e.solidColor=cc.color(0,0,0),e.autoDownTime=1,e.arrangedComp=null,e.ctx=null,e.blockMapStates=null,e.blockType=c.BlockTypeEnum.IBlock,e.blockStates2D=null,e.index=-1,e}return r(e,t),e.prototype.onLoad=function(){l.default.on(p.GAME_PAUSE,this.pause,this),l.default.on(p.SPACE_EVENT,this.space,this),l.default.on(p.ROTATE_EVENT,this.rotation,this),l.default.on(p.RIGHT_MOVE_EVENT,this.rightMove,this),l.default.on(p.LEFT_MOVE_EVENT,this.leftMove,this),l.default.on(p.DOWN_MOVE_EVENT,this.downMove,this),l.default.on(p.GAME_RESTART,this.stopAutoDownMove,this),l.default.on(p.CLEAR_FALLING_BLOCK_EVENT,this.clearFallingBlock,this),l.default.on(p.GENERATE_FALLING_BLOCK,this.generateDropBlock,this),l.default.on(p.GAME_RECOVER,this.startAutoDownMove,this),l.default.on(p.GAME_PAUSE,this.stopAutoDownMove,this),l.default.on(p.GAME_ANI_FULL_SCREEN,this.clear,this)},e.prototype.drawMapKeys=function(t){var e=this.meshComp.getBlockMap(),o=this.meshComp.getRectInfo(),i=o.blockLineWidth,r=o.inH,n=o.inW,a=o.offset,s=this.getCtx();s.clear();for(var c=0,l=t;c<l.length;c++){var p=l[c];if(e[p]){var u=e[p],h=u.x,f=u.y,d=u.width,_=u.height;s.lineWidth=i,s.strokeColor=this.outLineColor,s.rect(h,f,d,_),s.stroke(),s.fillRect(h+a+i/2,f+a+i/2,n,r),s.fillColor=this.solidColor,s.fill()}}},e.prototype.clearFallingBlock=function(){this.clear(),this.reset(),this.stopAutoDownMove()},e.prototype.generateDropBlock=function(){if(this.clear(),this.reset(),this.blockType=u.TetrisGameData.fallingBlockType,this.index=u.TetrisGameData.fallingBlockIndex,this.blockStates2D=c.AllBlockStates[this.blockType],l.default.emit(p.NEXT_FALLING_BLOCK),this.unscheduleAllCallbacks(),this.blockMapStates=this.getInitBlockMapStates(),this.blockType===c.BlockTypeEnum.IBlock?s.printFour(this.getBlockStates()):s.printThree(this.getBlockStates()),!this.checkGameOver()){var t=this.getBlockStates();this.defaultShowFirstRealBlock(t),this.drawDropStates(),this.startAutoDownMove()}},e.prototype.defaultShowFirstRealBlock=function(t){var e=this.blockMapStates.filter(function(e,o){return t[o]&&e}),o=this.meshComp.getRowCol().row,i=e[e.length-1][0]-(o-1);if(i>0)for(var r=0;r<this.blockMapStates.length;r++)this.blockMapStates[r][0]-=i;return this.blockMapStates},e.prototype.drawDropStates=function(){var t=this.getRealBlockMapStates().map(function(t){return t[0]+"_"+t[1]});this.drawMapKeys(t)},e.prototype.getCtx=function(){return this.ctx?this.ctx:(this.ctx=this.node.getComponent(cc.Graphics),this.ctx)},e.prototype.clear=function(){this.getCtx().clear()},e.prototype.reset=function(){this.blockMapStates=null,this.blockStates2D=null,this.index=-1,this.blockType=0,this.unschedule(this.downMove)},e.prototype.setGameStatesComp=function(t){this.arrangedComp=t},e.prototype.getGameStatusMap=function(){return u.TetrisGameData.gameStatusMap},e.prototype.space=function(){for(var t=this.getRealBlockMapStates(),e=t.length,o=[t[e-1]],i=function(e){var i=t[e];o.find(function(t){return t[1]===i[1]})||o.push(i)},r=e-2;r>=0;r--)i(r);for(var n=[],a=0,s=o;a<s.length;a++){var c=s[a],h=0;for(r=c[0]-1;r>=0;r--){var f=r+"_"+c[1],d=this.getGameStatusMap()[f];if(d){n.push(h);break}if(!d&&0===r){h++,n.push(h);break}h++}}var _=Math.min.apply(Math,n);this.blockMapStates.forEach(function(t){return t[0]-=_}),u.TetrisGameData.score+=10,l.default.emit(p.SCORE),this.writeGameStates()},e.prototype.rotation=function(){var t=(this.index+1)%this.blockStates2D.length,e=c.AllBlockStates[this.blockType][t],o=this.blockMapStates.map(function(t){return[t[0],t[1]]}),i=this.checkLeft(o,e),r=this.checkRight(o,e),n=this.checkDown(o,e);i&&r&&!n&&(this.index=t,this.blockMapStates=o,this.drawDropStates())},e.prototype.leftMove=function(){var t=this.blockMapStates.map(function(t){return[t[0],t[1]-1]});this.checkLeft(t)&&(this.blockMapStates=t,this.drawDropStates())},e.prototype.rightMove=function(){var t=this.blockMapStates.map(function(t){return[t[0],t[1]+1]});this.checkRight(t)&&(this.blockMapStates=t,this.drawDropStates())},e.prototype.downMove=function(){var t=this.blockMapStates.map(function(t){return[t[0]-1,t[1]]});this.checkDown(t)&c.OprateRestule.DOWN?this.writeGameStates():(this.blockMapStates=t,this.drawDropStates(),this.startAutoDownMove())},e.prototype.pause=function(){this.stopAutoDownMove()},e.prototype.stopAutoDownMove=function(){this.unschedule(this.downMove)},e.prototype.startAutoDownMove=function(){this.unschedule(this.downMove),this.schedule(this.downMove,this.autoDownTime/u.TetrisGameData.level)},e.prototype.getBlockStates=function(){return c.AllBlockStates[this.blockType][this.index]},e.prototype.getRealBlockMapStates=function(){var t=this.getBlockStates();return this.blockMapStates.filter(function(e,o){return t[o]&&e})},e.prototype.checkGameOver=function(){var t=this.checkCurFallingBlockOut(),e=this.checkNextFallingCollision();return!(!t||!e||(u.TetrisGameData.gameStatus=c.GAME_STATUS.GAME_OVER,l.default.emit(p.GAME_OVER_EVENT),0))},e.prototype.checkCurFallingBlockOut=function(){var t=this.meshComp.getRowCol().row;return!!this.getRealBlockMapStates().find(function(e){return e[0]>t-1})},e.prototype.checkNextFallingCollision=function(){var t=this;return!!this.getRealBlockMapStates().map(function(t){return[t[0]-1,t[1]]}).find(function(e){return t.getGameStatusMap()[e[0]+"_"+e[1]]})},e.prototype.checkLeft=function(t,e){var o=this;e=e||this.getBlockStates();var i=t.filter(function(t,o){return e[o]&&t}),r=i.find(function(t){return t[1]<0}),n=i.find(function(t){return o.getGameStatusMap()[t[0]+"_"+t[1]]});return r||n?0:c.OprateRestule.LEFT},e.prototype.checkRight=function(t,e){var o=this;e=e||this.getBlockStates();var i=t.filter(function(t,o){return e[o]&&t}),r=this.meshComp.getRowCol().col,n=i.find(function(t){return t[1]>=r}),a=i.find(function(t){return o.getGameStatusMap()[t[0]+"_"+t[1]]});return n||a?0:c.OprateRestule.RIGHT},e.prototype.checkDown=function(t,e){var o=this;e=e||this.getBlockStates();var i=t.filter(function(t,o){return e[o]&&t}),r=i.find(function(t){return t[0]<0});if(r)return c.OprateRestule.DOWN;var n=i.find(function(t){return o.getGameStatusMap()[t[0]+"_"+t[1]]});return r||n?c.OprateRestule.DOWN:0},e.prototype.writeGameStates=function(){this.clear(),this.unschedule(this.downMove);var t=this.getRealBlockMapStates().map(function(t){return t[0]+"_"+t[1]});l.default.emit(p.WRITE_GAME_STATUS,{keys:t}),this.checkGameOver()},e.prototype.getInitBlockMapStates=function(){return(this.blockType===c.BlockTypeEnum.IBlock?c.DropFourPoints:c.DropThreePoints).map(function(t){return t.map(function(t){return t})})},n([d(a.default)],e.prototype,"meshComp",void 0),n([d],e.prototype,"outLineColor",void 0),n([d],e.prototype,"solidColor",void 0),n([d({tooltip:"\u81ea\u52a8\u4e0b\u843d\u65f6\u95f4(s)"})],e.prototype,"autoDownTime",void 0),n([f],e)}(cc.Component);o.default=_,cc._RF.pop()},{"./TetrisBgGrid":"TetrisBgGrid","./common/TetrisConstant":"TetrisConstant","./common/TetrisData":"TetrisData","./common/TetrisEventType":"TetrisEventType","./common/TetrisObserver":"TetrisObserver","./common/TetrisUtil":"TetrisUtil"}],TetrisGame:[function(t,e,o){"use strict";cc._RF.push(e,"f3527S/io5G4KG4EHQL3RM5","TetrisGame");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./TetrisFallingBlock"),s=t("./TetrisArrangedBlock"),c=t("./TetrisBgGrid"),l=t("./TetrisMusicManager"),p=t("./common/TetrisEventType"),u=t("./common/TetrisData"),h=t("./UI/TetrisUIController"),f=t("./common/TetrisConstant"),d=t("./common/TetrisObserver"),_=t("./common/Tetris_i18"),T=cc._decorator,E=T.ccclass,m=T.property,A=T.executeInEditMode,S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._refresh=!1,e.uiController=null,e.musicComp=null,e.gameStatesComp=null,e.meshComp=null,e.dropMap=null,e.blockPrefab=null,e.blockPool=new cc.NodePool,e}return r(e,t),Object.defineProperty(e.prototype,"refresh",{get:function(){return this._refresh},set:function(t){this._refresh=t,this.randomBlock()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){_.Tetris_i18.default=u.TetrisGameData.lanuage,this.dropMap.setGameStatesComp(this.gameStatesComp),d.default.on(p.GAME_ANI_FULL_SCREEN,this.gameAniFullScreen,this),d.default.on(p.RESTART_END_EVENT,this.restartEndEvent,this),d.default.on(p.GAME_OVER_EVENT,this.gameOver,this)},e.prototype.start=function(){u.TetrisGameData.gameStatus===f.GAME_STATUS.GAME_OVER&&(d.default.emit(p.GAME_START_EVENT),this.gameOver())},e.prototype.gameOver=function(){console.log("GAME_OVER_EVENT  \u4e8b\u4ef6\u89e6\u53d1"),u.TetrisGameData.gameStatus=f.GAME_STATUS.ANI_START,d.default.emit(p.GAME_RESTART,{state:!0,row:0})},e.prototype.gameAniFullScreen=function(){d.default.emit(p.CLEAR_FALLING_BLOCK_EVENT)},e.prototype.restartEndEvent=function(){u.TetrisGameData.resetData(),u.TetrisGameData.gameStatus=f.GAME_STATUS.WAITING,d.default.emit(p.SHOW_UI_LOADING_EVENT),this.updateUI()},e.prototype.randomBlock=function(){this.dropMap.generateDropBlock()},e.prototype.getBlock=function(){var t=this.blockPool.get();return t||(t=cc.instantiate(this.blockPrefab)),t},e.prototype.putBlock=function(t){this.blockPool.put(t)},e.prototype.updateUI=function(){0===u.TetrisGameData.level&&(u.TetrisGameData.level=1),d.default.emit(p.SET_START_ROW),d.default.emit(p.SCORE),d.default.emit(p.SET_LEVEL)},e.prototype.pauseBtn=function(){console.log("pauseBtnEvent");var t=u.TetrisGameData.gameStatus;if(t!==f.GAME_STATUS.ANI_START&&t!==f.GAME_STATUS.ANI_FALLING_UP){if(t===f.GAME_STATUS.WAITING)return this.updateUI(),u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,d.default.emit(p.HIDE_UI_LOADING_EVENT),d.default.emit(p.GENERATE_FALLING_BLOCK),void d.default.emit(p.GAME_WAITING_TO_IN_GAME);t===f.GAME_STATUS.IN_GAME&&(u.TetrisGameData.gameStatus=f.GAME_STATUS.PAUSE,d.default.emit(p.GAME_PAUSE)),t===f.GAME_STATUS.PAUSE&&(u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,this.updateUI(),d.default.emit(p.GAME_RECOVER))}},e.prototype.spaceBtn=function(){console.log("spaceBtnEvent");var t=u.TetrisGameData.gameStatus;if(t!==f.GAME_STATUS.ANI_START&&t!==f.GAME_STATUS.ANI_FALLING_UP)return t===f.GAME_STATUS.WAITING?(u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,this.updateUI(),d.default.emit(p.GENERATE_FALLING_BLOCK),d.default.emit(p.HIDE_UI_LOADING_EVENT),void d.default.emit(p.GAME_WAITING_TO_IN_GAME)):t===f.GAME_STATUS.PAUSE?(u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,void d.default.emit(p.GAME_RECOVER)):void(t===f.GAME_STATUS.IN_GAME&&d.default.emit(p.SPACE_EVENT))},e.prototype.restartBtn=function(){console.log("restartBtn");var t=u.TetrisGameData.gameStatus;if(t!==f.GAME_STATUS.ANI_START&&t!==f.GAME_STATUS.ANI_FALLING_UP)return t===f.GAME_STATUS.WAITING?(u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,this.updateUI(),d.default.emit(p.HIDE_UI_LOADING_EVENT),d.default.emit(p.GENERATE_FALLING_BLOCK),void d.default.emit(p.GAME_WAITING_TO_IN_GAME)):void(t!==f.GAME_STATUS.IN_GAME&&t!==f.GAME_STATUS.PAUSE||(console.log(" \u91cd\u65b0\u5f00\u59cb\u6309\u94ae\u89e6\u53d1 GAME_RESTART"),d.default.emit(p.GAME_START_EVENT),u.TetrisGameData.resetData(),u.TetrisGameData.gameStatus=f.GAME_STATUS.ANI_START,d.default.emit(p.GAME_RESTART,{state:!0,row:0})))},e.prototype.audioBtn=function(){console.log("audioBtnEvent"),u.TetrisGameData.isCloseAudio=!u.TetrisGameData.isCloseAudio,d.default.emit(p.TOGGLE_AUDIO_EVENT)},e.prototype.rotateBtn=function(){console.log("rotationBtnEvent");var t=u.TetrisGameData.gameStatus;return t===f.GAME_STATUS.WAITING?(u.TetrisGameData.startLines=(u.TetrisGameData.startLines+1)%(u.TetrisGameData.maxStartLines+1),void d.default.emit(p.SET_START_ROW)):t===f.GAME_STATUS.PAUSE?(u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,void d.default.emit(p.GAME_RECOVER)):void d.default.emit(p.ROTATE_EVENT)},e.prototype.leftMoveBtn=function(){console.log("leftMoveBtnEvent");var t=u.TetrisGameData.gameStatus;return t===f.GAME_STATUS.WAITING?(u.TetrisGameData.level=++u.TetrisGameData.level%(u.TetrisGameData.maxLevel+1),0===u.TetrisGameData.level&&(u.TetrisGameData.level=1),void d.default.emit(p.SET_LEVEL)):t===f.GAME_STATUS.PAUSE?(u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,void d.default.emit(p.GAME_RECOVER)):void d.default.emit(p.LEFT_MOVE_EVENT)},e.prototype.rightMoveBtn=function(){console.log("rightMoveBtnEvent");var t=u.TetrisGameData.gameStatus;if(t===f.GAME_STATUS.WAITING){var e=u.TetrisGameData.level-1;return u.TetrisGameData.level=(e<1?u.TetrisGameData.maxLevel:e)%(u.TetrisGameData.maxLevel+1),void d.default.emit(p.SET_LEVEL)}if(t===f.GAME_STATUS.PAUSE)return u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,void d.default.emit(p.GAME_RECOVER);d.default.emit(p.RIGHT_MOVE_EVENT)},e.prototype.downMoveBtn=function(){console.log("downMoveBtnEvent");var t=u.TetrisGameData.gameStatus;if(t===f.GAME_STATUS.WAITING){var e=u.TetrisGameData.startLines-1;return u.TetrisGameData.startLines=(e<0?u.TetrisGameData.maxStartLines:e)%(u.TetrisGameData.maxStartLines+1),void d.default.emit(p.SET_START_ROW)}if(t===f.GAME_STATUS.PAUSE)return u.TetrisGameData.gameStatus=f.GAME_STATUS.IN_GAME,void d.default.emit(p.GAME_RECOVER);d.default.emit(p.DOWN_MOVE_EVENT)},e.prototype.onDestroy=function(){d.default.off(p.GAME_ANI_FULL_SCREEN,this.gameAniFullScreen,this),d.default.off(p.RESTART_END_EVENT,this.restartEndEvent,this)},n([m],e.prototype,"_refresh",void 0),n([m],e.prototype,"refresh",null),n([m(h.default)],e.prototype,"uiController",void 0),n([m(l.default)],e.prototype,"musicComp",void 0),n([m(s.default)],e.prototype,"gameStatesComp",void 0),n([m(c.default)],e.prototype,"meshComp",void 0),n([m(a.default)],e.prototype,"dropMap",void 0),n([m(cc.Prefab)],e.prototype,"blockPrefab",void 0),n([E,A],e)}(cc.Component);o.default=S,cc._RF.pop()},{"./TetrisArrangedBlock":"TetrisArrangedBlock","./TetrisBgGrid":"TetrisBgGrid","./TetrisFallingBlock":"TetrisFallingBlock","./TetrisMusicManager":"TetrisMusicManager","./UI/TetrisUIController":"TetrisUIController","./common/TetrisConstant":"TetrisConstant","./common/TetrisData":"TetrisData","./common/TetrisEventType":"TetrisEventType","./common/TetrisObserver":"TetrisObserver","./common/Tetris_i18":"Tetris_i18"}],TetrisMusicManager:[function(t,e,o){"use strict";cc._RF.push(e,"6c880MPd45Ca4XeHANkseAq","TetrisMusicManager");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./common/TetrisData"),s=t("./common/TetrisEventType"),c=t("./common/TetrisObserver"),l=cc._decorator,p=l.ccclass,u=l.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.startAudioSource=null,e.startAudioClip=null,e.fallAudioClip=null,e.gameOverAudioClip=null,e.clearAudioClip=null,e.rotateAudioClip=null,e.moveAudioClip=null,e.audioSource=null,e.volume=1,e.loop=!1,e}return r(e,t),e.prototype.onLoad=function(){c.default.on(s.SPACE_EVENT,this.playSpaceAudio,this),c.default.on(s.ROTATE_EVENT,this.playRotationAudio,this),c.default.on(s.RIGHT_MOVE_EVENT,this.playMoveAudio,this),c.default.on(s.LEFT_MOVE_EVENT,this.playMoveAudio,this),c.default.on(s.DOWN_MOVE_EVENT,this.playMoveAudio,this),c.default.on(s.CLEAR_BLOCK_EVENT,this.playclearAudio,this),c.default.on(s.GAME_START_EVENT,this.playStartAudio,this),c.default.on(s.GAME_OVER_EVENT,this.playGameOverAudio,this),this.setAudioSourceValum()},e.prototype.getAudioSource=function(){return this.audioSource?this.audioSource:(this.audioSource=this.node.addComponent(cc.AudioSource),this.audioSource.clip=this.moveAudioClip,this.audioSource)},e.prototype.setStartAudioSourceVolum=function(){this.startAudioSource.volume=this.volume,this.startAudioSource.loop=this.loop},e.prototype.playStartAudio=function(){a.TetrisGameData.isCloseAudio||(this.startAudioSource.clip=this.startAudioClip,this.startAudioSource.play())},e.prototype.playclearAudio=function(){console.log("\u64ad\u653e\u6d88\u9664\u65b9\u5757\u97f3\u6548"),a.TetrisGameData.isCloseAudio||(this.startAudioSource.clip=this.clearAudioClip,this.startAudioSource.play())},e.prototype.playSpaceAudio=function(){console.log("\u7acb\u5373\u843d\u4e0b\u6309\u94ae"),this.play(this.fallAudioClip)},e.prototype.playGameOverAudio=function(){this.play(this.gameOverAudioClip)},e.prototype.playRotationAudio=function(){this.play(this.rotateAudioClip)},e.prototype.playMoveAudio=function(){this.play(this.moveAudioClip)},e.prototype.stopAudio=function(){this.audioSource.stop()},e.prototype.play=function(t){a.TetrisGameData.isCloseAudio||(this.getAudioSource().clip=t,this.getAudioSource().play())},e.prototype.setAudioSourceValum=function(){this.getAudioSource().volume=this.volume,this.getAudioSource().loop=this.loop},e.prototype.onDestroy=function(){c.default.off(s.SPACE_EVENT,this.playSpaceAudio,this),c.default.off(s.ROTATE_EVENT,this.playRotationAudio,this),c.default.off(s.RIGHT_MOVE_EVENT,this.playMoveAudio,this),c.default.off(s.LEFT_MOVE_EVENT,this.playMoveAudio,this),c.default.off(s.CLEAR_BLOCK_EVENT,this.playclearAudio,this),c.default.off(s.GAME_START_EVENT,this.playStartAudio,this),c.default.off(s.GAME_OVER_EVENT,this.playGameOverAudio,this)},n([u(cc.AudioSource)],e.prototype,"startAudioSource",void 0),n([u(cc.AudioClip)],e.prototype,"startAudioClip",void 0),n([u(cc.AudioClip)],e.prototype,"fallAudioClip",void 0),n([u(cc.AudioClip)],e.prototype,"gameOverAudioClip",void 0),n([u(cc.AudioClip)],e.prototype,"clearAudioClip",void 0),n([u(cc.AudioClip)],e.prototype,"rotateAudioClip",void 0),n([u(cc.AudioClip)],e.prototype,"moveAudioClip",void 0),n([p],e)}(cc.Component);o.default=h,cc._RF.pop()},{"./common/TetrisData":"TetrisData","./common/TetrisEventType":"TetrisEventType","./common/TetrisObserver":"TetrisObserver"}],TetrisNextFallingBlock:[function(t,e,o){"use strict";cc._RF.push(e,"60dda052dVKYrLXIhd7zB+R","TetrisNextFallingBlock");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<o;e++)for(var n=arguments[e],a=0,s=n.length;a<s;a++,r++)i[r]=n[a];return i};Object.defineProperty(o,"__esModule",{value:!0});var s=t("./common/TetrisConstant"),c=t("./common/TetrisUtil"),l=t("./TetrisBgGrid"),p=t("./common/TetrisData"),u=t("./common/TetrisObserver"),h=t("./common/TetrisEventType"),f=cc._decorator,d=f.ccclass,_=f.property,T=f.executeInEditMode,E=[[3,0],[3,1],[3,2],[3,3],[2,0],[2,1],[2,2],[2,3],[1,0],[1,1],[1,2],[1,3],[0,0],[0,1],[0,2],[0,3]],m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._refresh=!1,e.meshComp=null,e.outLineColor=cc.color(0,0,0),e.solidColor=cc.color(0,0,0),e}return r(e,t),Object.defineProperty(e.prototype,"refresh",{get:function(){return this._refresh},set:function(t){this._refresh=t,this.nextFallingBlock()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){u.default.on(h.NEXT_FALLING_BLOCK,this.nextFallingBlock,this)},e.prototype.nextFallingBlock=function(){var t=c.randomByLen(s.AllBlockStates.length),e=c.randomByLen(s.AllBlockStates[t].length),o=s.AllBlockStates[t][e];p.TetrisGameData.fallingBlockType=t,p.TetrisGameData.fallingBlockIndex=e,t!==s.BlockTypeEnum.IBlock&&(o=this.extendArr(o)),c.printFour(o);var i=E.filter(function(t,e){return o[e]&&t}).map(function(t){return t[0]+"_"+t[1]});this.meshComp.drawByKeys(i,this.outLineColor,this.solidColor)},e.prototype.extendArr=function(t){var e=t.slice(0,3),o=t.slice(3,6),i=t.slice(6,9);return a([0],e,[0],o,[0],i,[0,0,0,0])},n([_],e.prototype,"_refresh",void 0),n([_],e.prototype,"refresh",null),n([_(l.default)],e.prototype,"meshComp",void 0),n([_],e.prototype,"outLineColor",void 0),n([_],e.prototype,"solidColor",void 0),n([d,T],e)}(cc.Component);o.default=m,cc._RF.pop()},{"./TetrisBgGrid":"TetrisBgGrid","./common/TetrisConstant":"TetrisConstant","./common/TetrisData":"TetrisData","./common/TetrisEventType":"TetrisEventType","./common/TetrisObserver":"TetrisObserver","./common/TetrisUtil":"TetrisUtil"}],TetrisObserver:[function(t,e,o){"use strict";cc._RF.push(e,"a776bX6DYtECrb+E704w+Je","TetrisObserver"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.on=function(t,e,o,i){void 0===i&&(i=!1),this._eventMap.has(t)||this._eventMap.set(t,[]),this._eventMap.get(t).push({callBack:e,target:o,force:i})},t.emit=function(t,e){void 0===e&&(e=t),this._eventMap.has(t)&&this._eventMap.get(t).forEach(function(t){var o=t.callBack,i=t.target,r=t.force;r&&i.isValid?o.call(i,e):!r&&i.enabledInHierarchy&&i.isValid&&o.call(i,e)})},t.off=function(t,e,o){if(this._eventMap.has(t))for(var i=this._eventMap.get(t),r=i.length-1;r>=0;r--){var n=i[r];n&&n.callBack===e&&n.target===o&&i.splice(r,1)}},t.offEventType=function(t){this._eventMap.has(t)&&this._eventMap.delete(t)},t.release=function(){this._eventMap.clear()},t._eventMap=new Map,t}();o.default=i,cc._RF.pop()},{}],TetrisTime:[function(t,e,o){"use strict";cc._RF.push(e,"246b0Si8qFKtIkAmAnUhpdM","TetrisTime");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hourLabel=null,e.middleNode=null,e.minuteLabel=null,e.date=null,e}return r(e,t),e.prototype.onLoad=function(){var t=this;this.date=new Date,this.updateTime();var e=cc.tween(this.middleNode).blink(1,1);cc.tween(this.middleNode).repeatForever(e).start();var o=cc.tween(this.node).delay(30).call(function(){t.updateTime()});cc.tween(this.node).repeatForever(o).start()},e.prototype.updateTime=function(){this.hourLabel.string=this.adjust(this.date.getHours()).toString(),this.minuteLabel.string=this.adjust(this.date.getMinutes()).toString()},e.prototype.adjust=function(t){return t<10?"0 "+t:t.toString()},e.prototype.stopTween=function(){cc.tween(this.node).stop(),cc.tween(this.middleNode).stop()},e.prototype.onDisable=function(){this.stopTween()},e.prototype.onDestroy=function(){this.stopTween()},n([c(cc.Label)],e.prototype,"hourLabel",void 0),n([c(cc.Node)],e.prototype,"middleNode",void 0),n([c(cc.Label)],e.prototype,"minuteLabel",void 0),n([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],TetrisToggleSprite:[function(t,e,o){"use strict";cc._RF.push(e,"336c74RHidLN7TepySkMyyG","TetrisToggleSprite");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=a.executeInEditMode,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.normalFrame=null,e.hideFrame=null,e._hide=!0,e}return r(e,t),Object.defineProperty(e.prototype,"hide",{get:function(){return this._hide},set:function(t){this._hide!==t&&(this._hide=t,this.toggleSprite())},enumerable:!1,configurable:!0}),e.prototype.setNormalFrame=function(){this.node.getComponent(cc.Sprite).spriteFrame=this.normalFrame},e.prototype.setHideFrame=function(){this.node.getComponent(cc.Sprite).spriteFrame=this.hideFrame},e.prototype.toggleSprite=function(){this._hide=!this._hide,this.node.getComponent(cc.Sprite).spriteFrame=this._hide?this.hideFrame:this.normalFrame},n([c(cc.SpriteFrame)],e.prototype,"normalFrame",void 0),n([c(cc.SpriteFrame)],e.prototype,"hideFrame",void 0),n([c],e.prototype,"_hide",void 0),n([c],e.prototype,"hide",null),n([s,l],e)}(cc.Component);o.default=p,cc._RF.pop()},{}],TetrisType:[function(t,e,o){"use strict";cc._RF.push(e,"f7a22fpqttEC59BjTHkJm3m","TetrisType"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TetrisUIController:[function(t,e,o){"use strict";cc._RF.push(e,"d4f67ZqxYtCU5B6B+Acb6GB","TetrisUIController");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=t("../common/TetrisConstant"),s=t("../common/TetrisData"),c=t("../common/TetrisEventType"),l=t("../common/TetrisObserver"),p=t("../common/Tetris_i18"),u=t("./TetrisToggleSprite"),h=t("./TetrisUIWaitAnimation"),f=cc._decorator,d=f.ccclass,_=f.property,T=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.socreTipLabel=null,e.socreLabel=null,e.clearLineTipLabel=null,e.clearLineLabel=null,e.levelTipLabel=null,e.levelLabel=null,e.nextTipLabel=null,e.waitAnimationComp=null,e.hornComp=null,e.pauseComp=null,e}return r(e,t),e.prototype.onLoad=function(){l.default.on(c.SHOW_UI_LOADING_EVENT,this.showWaitAnimation,this),l.default.on(c.HIDE_UI_LOADING_EVENT,this.hideWaitAnimation,this),l.default.on(c.SET_LEVEL,this.setLevelLabel,this),l.default.on(c.SET_START_ROW,this.setLinesLabel,this),l.default.on(c.SCORE,this.setSocreLabel,this),l.default.on(c.GAME_PAUSE,this.setPauseSprite,this),l.default.on(c.GAME_RECOVER,this.setPauseSprite,this),l.default.on(c.TOGGLE_AUDIO_EVENT,this.setHornSprite,this)},e.prototype.showWaitAnimation=function(){this.waitAnimationComp.show()},e.prototype.hideWaitAnimation=function(){console.log("hideWaitAnimation"),this.waitAnimationComp.hide()},e.prototype.randomSocreLabel=function(){var t=Math.round(2*Math.random())-1,e=s.TetrisGameData.score;0===t||0===e?(this.socreTipLabel.string=p.Tetris_i18.data.highestScore[p.Tetris_i18.default],this.socreLabel.string=s.TetrisGameData.highestScore.toString()):1===t&&(this.socreTipLabel.string=p.Tetris_i18.data.lastScore[p.Tetris_i18.default],this.socreLabel.string=s.TetrisGameData.lastScore.toString())},e.prototype.setSocreLabel=function(){var t=this;this.setLinesLabel(),this.unscheduleAllCallbacks(),a.GAME_STATUS.WAITING===s.TetrisGameData.gameStatus?(this.randomSocreLabel(),this.schedule(function(){t.randomSocreLabel()},2)):(this.socreTipLabel.string=p.Tetris_i18.data.score[p.Tetris_i18.default],this.socreLabel.string=s.TetrisGameData.score.toString())},e.prototype.setLinesLabel=function(){console.log("setLinesLabel",s.TetrisGameData.gameStatus),a.GAME_STATUS.WAITING===s.TetrisGameData.gameStatus?(this.clearLineTipLabel.string=p.Tetris_i18.data.linesStart[p.Tetris_i18.default],this.clearLineLabel.string=s.TetrisGameData.startLines.toString()):(this.clearLineTipLabel.string=p.Tetris_i18.data.linesCleared[p.Tetris_i18.default],this.clearLineLabel.string=s.TetrisGameData.linesCleared.toString())},e.prototype.setLevelLabel=function(){this.levelTipLabel.string=p.Tetris_i18.data.level[p.Tetris_i18.default],this.levelLabel.string=s.TetrisGameData.level.toString()},e.prototype.setNextTipLabel=function(){this.nextTipLabel.string=p.Tetris_i18.data.level[p.Tetris_i18.default]},e.prototype.setHornSprite=function(){console.log("setHornSprite"),this.hornComp.toggleSprite()},e.prototype.setPauseSprite=function(){s.TetrisGameData.gameStatus===a.GAME_STATUS.PAUSE&&this.pauseComp.setNormalFrame(),s.TetrisGameData.gameStatus===a.GAME_STATUS.IN_GAME&&this.pauseComp.setHideFrame()},e.prototype.onDestroy=function(){l.default.off(c.SHOW_UI_LOADING_EVENT,this.showWaitAnimation,this),l.default.off(c.HIDE_UI_LOADING_EVENT,this.hideWaitAnimation,this),l.default.off(c.SET_LEVEL,this.setLevelLabel,this),l.default.off(c.SET_START_ROW,this.setLinesLabel,this),l.default.off(c.SCORE,this.setSocreLabel,this),l.default.off(c.GAME_PAUSE,this.setPauseSprite,this),l.default.off(c.GAME_RECOVER,this.setPauseSprite,this),l.default.off(c.TOGGLE_AUDIO_EVENT,this.setHornSprite,this)},n([_(cc.Label)],e.prototype,"socreTipLabel",void 0),n([_(cc.Label)],e.prototype,"socreLabel",void 0),n([_(cc.Label)],e.prototype,"clearLineTipLabel",void 0),n([_(cc.Label)],e.prototype,"clearLineLabel",void 0),n([_(cc.Label)],e.prototype,"levelTipLabel",void 0),n([_(cc.Label)],e.prototype,"levelLabel",void 0),n([_(cc.Label)],e.prototype,"nextTipLabel",void 0),n([_(h.default)],e.prototype,"waitAnimationComp",void 0),n([_(u.default)],e.prototype,"hornComp",void 0),n([_(u.default)],e.prototype,"pauseComp",void 0),n([d],e)}(cc.Component);o.default=T,cc._RF.pop()},{"../common/TetrisConstant":"TetrisConstant","../common/TetrisData":"TetrisData","../common/TetrisEventType":"TetrisEventType","../common/TetrisObserver":"TetrisObserver","../common/Tetris_i18":"Tetris_i18","./TetrisToggleSprite":"TetrisToggleSprite","./TetrisUIWaitAnimation":"TetrisUIWaitAnimation"}],TetrisUIWaitAnimation:[function(t,e,o){"use strict";cc._RF.push(e,"cf44bTv1l5NM4VE9JpRvkVr","TetrisUIWaitAnimation");var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,i){var r,n=arguments.length,a=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,o,a):r(e,o))||a);return n>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,s=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingAnimation=null,e.isReverse=!1,e}return r(e,t),e.prototype.onLoad=function(){var t=this;this.loadingAnimation.on(cc.Animation.EventType.FINISHED,function(){t.isReverse?t.scheduleOnce(function(){t.play()},2):t.scheduleOnce(function(){t.playReverse()},2)})},e.prototype.play=function(){this.isReverse=!1,this.loadingAnimation.node.scaleX=1,this.loadingAnimation.play()},e.prototype.playReverse=function(){this.loadingAnimation.node.scaleX=-1,this.loadingAnimation.play(),this.isReverse=!0},e.prototype.playLoadingAnimation=function(){var t=this;this.reset(),cc.tween(this.node).delay(.5).blink(1,2).call(function(){t.unscheduleAllCallbacks(),t.play()}).start()},e.prototype.show=function(){console.log("show ui loading"),this.node.active=!0,this.playLoadingAnimation()},e.prototype.hide=function(){console.log("hide ui loading"),this.reset(),this.node.active=!1},e.prototype.reset=function(){cc.tween(this.node).stop(),this.unscheduleAllCallbacks()},e.prototype.onDisable=function(){this.unscheduleAllCallbacks()},n([c(cc.Animation)],e.prototype,"loadingAnimation",void 0),n([s],e)}(cc.Component);o.default=l,cc._RF.pop()},{}],TetrisUtil:[function(t,e,o){"use strict";function i(t){return Math.round(Math.random()*(t-1))}cc._RF.push(e,"fc60c360wlOkZtQDcLaGYAw","TetrisUtil"),Object.defineProperty(o,"__esModule",{value:!0}),o.randomPredefinedRow=o.printFour=o.printThree=o.randomByLen=void 0,o.randomByLen=i,o.printThree=function(t){console.log(t[0]+"  "+t[1]+"  "+t[2]+"\n"+t[3]+"  "+t[4]+"  "+t[5]+"\n"+t[6]+"  "+t[7]+"  "+t[8])},o.printFour=function(t){console.log(t[0]+"  "+t[1]+"  "+t[2]+"  "+t[3]+"\n"+t[4]+"  "+t[5]+"  "+t[6]+"  "+t[7]+"\n"+t[8]+"  "+t[9]+"  "+t[10]+"  "+t[11]+"\n"+t[12]+"  "+t[13]+"  "+t[14]+"  "+t[15])},o.randomPredefinedRow=function(t,e,o,r){void 0===o&&(o=3),void 0===r&&(r=1),o+r>e&&console.error("\u53c2\u6570\u9519\u8bef,\u7b49\u4e8e1 \u7b49\u4e8e0\u7684\u603b\u662f\u4e0d\u80fd\u5927\u4e8e \u5217\u6570",e,o,r);for(var n=Array(e).fill(0),a=n.map(function(t,e){return e+t}),s=0;s<o;s++)n[a[c=i(a.length)]]=1,a.splice(c,1);for(s=0;s<r;s++){var c;n[a[c=i(a.length)]]=0,a.splice(c,1)}for(s=0;s<a.length;s++)n[a[s]]=Math.round(Math.random());var l={};for(s=0;s<n.length;s++)l[t+"_"+s]=n[s];return l},cc._RF.pop()},{}],Tetris_i18:[function(t,e,o){"use strict";cc._RF.push(e,"93be3SVLcRCGLhOIgjHejU/","Tetris_i18"),Object.defineProperty(o,"__esModule",{value:!0}),o.Tetris_i18=void 0,o.Tetris_i18={lanuage:["cn","en"],default:"cn",data:{title:{cn:"\u4fc4\u7f57\u65af\u65b9\u5757",en:"Tetris"},score:{cn:"\u5f97\u5206",en:"Score"},highestScore:{cn:"\u6700\u9ad8\u5206",en:"Highest Score"},lastScore:{cn:"\u4e0a\u4e00\u573a\u5f97\u5206",en:"Last Score"},linesCleared:{cn:"\u6d88\u9664\u884c",en:"Lines Cleared"},linesStart:{cn:"\u8d77\u59cb\u884c",en:"Start lines"},level:{cn:"\u7ea7\u522b",en:"Level"},next:{en:"Next",cn:"\u4e0b\u4e00\u4e2a"}}},cc._RF.pop()},{}]},{},["TetrisArrangedBlock","TetrisBgGrid","TetrisFallingBlock","TetrisGame","TetrisMusicManager","TetrisNextFallingBlock","TetrisTime","TetrisToggleSprite","TetrisUIController","TetrisUIWaitAnimation","TetrisConstant","TetrisData","TetrisEventType","TetrisObserver","TetrisType","TetrisUtil","Tetris_i18"]);